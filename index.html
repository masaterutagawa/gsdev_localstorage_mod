<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./asset/css/import.css">
    <script src="https://code.jquery.com/jquery-3.6.4.js"
        integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E=" crossorigin="anonymous"></script>
    <title>ローカルストレージ課題</title>
</head>

<body>

    <div class="container">
        <!-- テキストを入力した付箋を出力するエリア -->
        <div id="stickyNote__container">


        </div><!-- /#stickyNote__container -->

        <div class="status__area">
            <p id="status">今日の気づきをメモしましょー</p>
        </div><!-- /.status__area -->

        <!-- 付箋へのテキスト入力のボタン -->
        <div id="stickyNote__input">
            <h3>今日の気づきを一言でいえば？</h3>
            <input type="text" id="stickyNote__Title">

            <h3>具体的にいうと？</h3>
            <textarea id="stickyNote__Text"></textarea>
        </div><!-- /#stickyNote__inputText -->


        <div class="menu__area">

            <div id="stickyNoteAdd">気づきを投稿する</div>
            <div id="dataSave">気づきを保存する</div>
            <div id="dataLoad">保存内容を呼び出す</div>
            <div id="dataClear">保存内容を消去する</div>

        </div>

    </div><!-- /.container -->



    <script>

        // 付箋データを格納する配列を作成
        const stickyNotes = [];

        // ページのDOMツリーを読み込む
        $(document).ready(function () {

            //  セーブボタンを非表示
            $('#dataSave').hide();
            //  クリアボタンを非表示
            $('#dataClear').hide();

            //  ローカルストレージにデータが保存されている場合はロードボタンを表示
            if (localStorage.length > 0) {
                $('#dataLoad').show();
            } else {
                $('#dataLoad').hide();
            }

            // 入力したテキストを出力する
            $('#stickyNoteAdd').on('click', function () {

                // 入力されたタイトルと内容を取得
                const stickyNoteTitle = $('#stickyNote__Title').val();
                const stickyNoteText = $('#stickyNote__Text').val();

                // タイトルと内容が空の場合は処理を中断
                if (stickyNoteTitle === '' || stickyNoteText === '') {
                    $('#status').html('気づきが未入力です');
                }
                else {
                    // stickyNoteTitleとstickyNoteTextをオブジェクトstickNoteDataに格納
                    const stickyNoteData = {
                        title: stickyNoteTitle,
                        text: stickyNoteText
                    };
                    // 付箋データを配列の最後に追加
                    stickyNotes.push(stickyNoteData)

                    // 付箋のhtml要素を生成する関数
                    $('#stickyNote__container').append('<div class="stickyNote">' + '<h4>' + stickyNoteData.title + '</h4>' + '<p>' + stickyNoteData.text + '</p>' + '</div>').hide().fadeIn(1000);
                    // 付箋の追加後は入力したテキストをクリア
                    $('#stickyNote__Title').val('');
                    $('#stickyNote__Text').val('');
                    $('#status').html('気づきを追加しました');
                    console.log(stickyNotes.length);
                }
                // saveボタンを表示
                if (stickyNotes.length > 0) {
                    $('#dataSave').show();
                    $('#dataLoad').hide();
                }

            });



            // ローカルストレージに保存
            $('#dataSave').on('click', function () {
                // 配列stickyNotesの要素数がiより大きい間は繰り返す
                for (let i = 0; i < stickyNotes.length; i++) {
                    const stickyNoteTitle = stickyNotes[i].title;
                    const stickyNoteText = stickyNotes[i].text;
                    // stickyNoteTitleとstickyNoteTextをオブジェクトstickNoteDataに格納
                    localStorage.setItem('title' + i, stickyNoteTitle);
                    localStorage.setItem('text' + i, stickyNoteText);
                }
                $('#status').html('投稿データを保存しました');
                $('#dataSave').hide();
                $('#dataClear').show();
            });






            // データ削除TEST
            $('#dataClear').on('click', function () {

                //  データが保存されているかチェック
                if (localStorage.length > 0) {

                    // localStorageの要素数がiより大きい間は繰り返す
                    for (let i = 0; i < localStorage.length; i++) {

                        // stickyNoteTitleとstickyNoteTextをオブジェクトstickNoteDataに格納
                        const text = localStorage.removeItem('title' + i);
                        const text02 = localStorage.removeItem('text' + i);
                    }

                    $('#status').html('データを削除しました');
                    $('.stickyNote').remove();
                    $('#dataClear').hide();

                }
                else {
                    $('#status').html('でーたないよ');
                }
                // //付箋データの配列も空にする これ理解できていないので調査
                // stickyNotes.length = 0;


            });



            // ローカルストレージのデータをロード
            $('#dataLoad').on('click', function () {

                console.log(localStorage);


                //  データが保存されているかチェック
                if (localStorage.length > 0) {
                    $('#status').html('データを復元しました');

                    // localStorageの要素数がiより大きい間は繰り返す
                    for (let i = 0; i < localStorage.length / 2; i++) {

                        // console.log(localStorage.length / 2);
                        // console.log(localStorage[i]);

                        // stickyNoteTitleとstickyNoteTextをオブジェクトstickNoteDataに格納
                        const text = localStorage.getItem('title' + i);
                        const text02 = localStorage.getItem('text' + i);


                        $('#stickyNote__container').append('<div class="stickyNote">' + '<h4>' + text + '</h4>' + '<p>' + text02 + '</p>' + '</div>');


                    }
                    // ロードボタンを非表示
                    $('#dataLoad').hide();
                    $('#dataClear').show();

                }
                else {
                    $('#status').html('データ内よありませんよー');
                }



                // const text = localStorage.getItem('title0');
                // // テキストエリアに情報を表示．
                // $('#tagawa').html(text);



            });



        });
    </script>
</body>

</html>