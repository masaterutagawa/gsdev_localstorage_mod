<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./asset/css/import.css">
    <script src="https://code.jquery.com/jquery-3.6.4.js"
        integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E=" crossorigin="anonymous"></script>
    <title>ローカルストレージ課題</title>
</head>

<body>






    <!-- テキストを入力した付箋を出力するエリア -->
    <div id="stickyNote__container">


    </div><!-- /#stickyNote__container -->

    <div id="stickyNote__dammy">


    </div><!-- /#stickyNote__dammy -->

    <!-- 付箋へのテキスト入力のボタン -->
    <div id="stickyNote__input">
        <h3>付箋のタイトル</h3>
        <input type="text" id="stickyNote__Title">
        <p>付箋の内容</p>
        <textarea id="stickyNote__Text"></textarea>
    </div><!-- /#stickyNote__inputText -->


    <ul>
        <li id="stickyNoteAdd">Add</li>
        <li id="dataSave">Save</li>
        <li id="dataLoad">Load</li>
        <li id="dataClear">Clear</li>
    </ul>
    <p id="status">ステータス</p>


    <script>

        // 付箋データを格納する配列を作成
        const stickyNotes = [];

        // ページのDOMツリーを読み込む
        $(document).ready(function () {

            // ロードボタン隠す
            $('#dataLoad').hide();


            // 入力したテキストを出力する
            $('#stickyNoteAdd').on('click', function () {

                // 入力されたタイトルと内容を取得
                const stickyNoteTitle = $('#stickyNote__Title').val();
                const stickyNoteText = $('#stickyNote__Text').val();

                // タイトルと内容が空の場合は処理を中断
                if (stickyNoteTitle === '' || stickyNoteText === '') {
                    $('#status').html('タイトルと内容を入力してください');
                }
                else {
                    // stickyNoteTitleとstickyNoteTextをオブジェクトstickNoteDataに格納
                    const stickyNoteData = {
                        title: stickyNoteTitle,
                        text: stickyNoteText
                    };
                    // 付箋データを配列の最後に追加
                    stickyNotes.push(stickyNoteData)
                    // console.dir(stickyNotes);
                    // 付箋のhtml要素を生成する関数
                    $('#stickyNote__container').append('<div class="stickyNote">' + '<h4>' + stickyNoteData.title + '</h4>' + '<p>' + stickyNoteData.text + '</p>' + '</div>').hide().fadeIn(1000);
                    // 付箋の追加後は入力したテキストをクリア
                    $('#stickyNote__Title').val('');
                    $('#stickyNote__Text').val('');
                    $('#status').html('付箋を追加しました');
                }




            });


            // ローカルストレージに保存
            $('#dataSave').on('click', function () {
                // 配列stickyNotesの要素数がiより大きい間は繰り返す
                for (let i = 0; i < stickyNotes.length; i++) {
                    // console.log(stickyNotes[i]);
                    // console.log(stickyNotes.length);

                    const stickyNoteTitle = stickyNotes[i].title;
                    // console.log(stickyNotes[0].title);
                    const stickyNoteText = stickyNotes[i].text;
                    // console.log(stickyNotes[0].text);
                    // stickyNoteTitleとstickyNoteTextをオブジェクトstickNoteDataに格納
                    localStorage.setItem('title' + i, stickyNoteTitle);
                    localStorage.setItem('text' + i, stickyNoteText);
                }
                $('#status').html('データを保存しました');
                // ロードボタン表示
                $('#dataLoad').show();
            });

            // ローカルストレージのデータ削除
            $('#dataClear').on('click', function () {
                // 配列stickyNotesの要素数がiより大きい間は繰り返す
                for (let i = 0; i < stickyNotes.length; i++) {
                    // console.log(stickyNotes[i]);

                    const stickyNoteTitle = stickyNotes[i].title;
                    // console.log(stickyNotes[0].title);
                    const stickyNoteText = stickyNotes[i].text;
                    // console.log(stickyNotes[0].text);
                    // stickyNoteTitleとstickyNoteTextをオブジェクトstickNoteDataに格納
                    localStorage.removeItem('title' + i);
                    localStorage.removeItem('text' + i);
                }
                // console.log(localStorage.title);
                $('#stickyNote__Title').val('');
                $('#stickyNote__Text').val('');
                $('.stickyNote').remove();
                $('#status').html('データを削除しました');




                // // 付箋データの配列も空にする これ理解できていないので調査
                // stickyNotes.length = 0;
            });



            // ローカルストレージのデータをロード
            $('#dataLoad').on('click', function () {

                console.log(localStorage);


                //  データが保存されているかチェック
                if (localStorage.length > 0) {
                    $('#status').html('でーたあるよ');

                    // 配列stickyNotesの要素数がiより大きい間は繰り返す
                    for (let i = 0; i < localStorage.length / 2; i++) {

                        // 半分にする
                        console.log(localStorage.length / 2);
                        // console.log(localStorage[i]);


                        // stickyNoteTitleとstickyNoteTextをオブジェクトstickNoteDataに格納
                        const text = localStorage.getItem('title' + i);
                        const text02 = localStorage.getItem('text' + i);


                        $('#stickyNote__container').append('<div class="stickyNote">' + '<h4>' + text + '</h4>' + '<p>' + text02 + '</p>' + '</div>');
                        // ロードボタン削除
                        $('#dataLoad').remove();

                    }


                }
                else {
                    $('#status').html('でーたないよ');
                }



                // const text = localStorage.getItem('title0');
                // // テキストエリアに情報を表示．
                // $('#tagawa').html(text);



            });



        });
    </script>
</body>

</html>